!function(a,o){var s,e=!1;try{e=parent&&parent.acPU}catch(d){}if(e)s=parent.acPU;else{var l=function(){this._variableName="acPU",this._currentIndex=0,this._previousIndex=null,this._isShown=!1,this._modals=new Array,this._moveModalInfo=null,this._isDragging=!1,this._bodyOverflow=null,this._modalMaskCssClass="ac-modal-mask",this._modalCssClass="ac-modal",this._modalTitleCssClass="ac-modal-title",this._modalCloseCssClass="ac-modal-close",this._modalIframeCssClass="ac-modal-iframe",this._modalContentCssClass="ac-modal-content",this._modalLoaderCssClass="ac-modal-loader",this._modalFooterCssClass="ac-modal-footer",this._defaults={width:800,height:600,zIndex:2e12,title:null,onClose:null}};l.prototype={Open:function(a,o,s,e){this.open(a,{width:o,height:s,onClose:e})},open:function(s,e){var d=this,l=o.extend(d._defaults,e,{});d.init(l);var t=d._modals[d._currentIndex];t.modalTitle.children("span");if(t.modalIframe.unbind("load.acPU").bind("load.acPU",{m:t,options:l},d._frameLoaded),d._currentIndex>0){var n=o("."+d._modalCssClass).not(t.modal);n.css({opacity:"0.4",filter:"alpha(opacity=40)"}),n.find("."+d._modalTitleCssClass).unbind("mousedown.acPU")}(null==d._previousIndex||d._previousIndex<0)&&(d._bodyOverflow=o("body").css("overflow")),o("body").css("overflow","hidden");var i=o(a).width(),r=o(a).height(),c=o(a).scrollLeft(),m=o(a).scrollTop(),u=d._calculateDimensions(t,l,i,r,c,m);t.modalLoader.css({left:u.width/2-t.modalLoader.width()/2,top:u.height/2-t.modalLoader.height()/2}),t.modalIframe.attr("src",s),t.modal.css({width:u.width,height:u.height,top:u.y,left:u.x}).show(),t.modalMask.css({top:m,left:c,width:i,height:r}).show(),d._previousIndex=d._currentIndex,d._currentIndex=d._currentIndex+1,d._isShown=!0},Close:function(a){this.close(a)},close:function(s){var e=this;if(e._isShown){var d=e._modals[e._previousIndex],l=d.modal,t=d.modalMask,n=d.onClose;e._modals[e._previousIndex]=null,e._currentIndex=e._previousIndex,e._previousIndex=e._previousIndex-1,l.remove(),e._previousIndex<0?(t.remove(),o("body").css("overflow",e._bodyOverflow),o(a).unbind(".acPU"),e._bodyOverflow=null,e._previousIndex=null,e._isShown=!1):(d=e._modals[e._previousIndex],d.modal.css({opacity:"1.0",filter:"alpha(opacity=100)"}),d.modalTitle.bind("mousedown.acPU",{pu:e,index:e._previousIndex},e._dragStart)),n&&n(s)}},resize:function(s){var e=s.data.pu,d=s.data.index,l=s.data.options,t=e._modals[d],n=o(a).height(),i=o(a).width(),r=a.scrollX,c=a.scrollY,m=e._calculateDimensions(t,l,i,n,r,c);t.modal.css({width:m.width,height:m.height,top:m.y,left:m.x})},scroll:function(a){var o=a.data.pu;o.resize(a)},init:function(s){var e=this,d=o("#dvModalMask");0==d.length&&(d=o("<div />").attr("id","dvModalMask").addClass(e._modalMaskCssClass),d.css({width:"auto",height:"auto",position:"absolute",display:"none",overflow:"hidden",zIndex:s.zIndex}),d.appendTo("body"));var l=o("<div />").addClass(e._modalCssClass).addClass("padded1");l.css({width:"auto",height:"auto",position:"absolute",display:"none",zIndex:s.zIndex}),e._disableSelection(l);var t={pu:e,index:e._currentIndex},n=o("<div />").addClass(e._modalTitleCssClass).css("display","none");n.bind("mousedown.acPU",t,e._dragStart),e._disableSelection(n),n.appendTo(l);var i=o("<div />").addClass(e._modalCloseCssClass).html("&times;");i.bind("click.acPU",t,function(){e.close()}),i.appendTo(n);var r=o("<span />");e._disableSelection(r),n.append(r);var c=o("<div />").addClass(e._modalContentCssClass);c.css("display","none"),c.appendTo(l);var m=o("<div />").addClass(e._modalLoaderCssClass);m.css("position","absolute"),m.appendTo(l);var u=o("<iframe />").addClass(e._modalIframeCssClass);u.css({width:"100%",border:"0 none"}).attr("frameborder","no"),u.appendTo(c);var p=o("<div />").addClass(e._modalFooterCssClass).css("display","none");p.appendTo(l),t.options=s,l.appendTo("body"),o(a).bind("resize.acPU",t,e.resize),o(a).bind("scroll.acPU",t,e.scroll),e._modals[e._currentIndex]={modal:l,modalTitle:n,modalClose:i,modalMask:d,modalIframe:u,modalContent:c,modalLoader:m,modalFooter:p,onClose:s.onClose}},_calculateDimensions:function(a,o,s,e,d,l){var t=o.height,n=o.width,i=a.modalClose.height(),r=a.modalClose.width();n+r>s&&(n=s-r),t+i>e&&(t=e-i),d||(d=0),l||(l=0);var c=s/2-n/2+d,m=e/2-t/2+l,u={width:n,height:t,x:c,y:m};return u},_frameLoaded:function(a){var o=a.data.m,s=a.data.options,e=o.modalTitle.children("span"),d="AmeriCommerce Popup";o.modalLoader.css("display","none"),o.modalContent.css("display","block");try{var l=o.modalIframe.contents().find("title").html();l.length>0&&(d=l)}catch(t){}s.title&&(d=s.title),e.html(d),o.modalTitle.css("display","block"),o.modalFooter.css("display","block")},_dragStart:function(a){var s=a.data.pu,e=a.data.index,d=s._modals[e];s._moveModalInfo={startMouseX:a.pageX,startMouseY:a.pageY,startModalX:parseInt(d.modal.css("left").replace("px","")),startModalY:parseInt(d.modal.css("top").replace("px",""))},o(document).bind("mouseup.acPU",a.data,s._dragEnd),o(document).bind("mousemove.acPU",a.data,s._dragMove),d.modalIframe.css({display:"none"}),s._isDragging=!0},_dragMove:function(a){var o=a.data.pu,s=a.data.index,e=o._modals[s],d=a.pageX,l=a.pageY,t=d-o._moveModalInfo.startMouseX,n=l-o._moveModalInfo.startMouseY;e.modal.css({left:o._moveModalInfo.startModalX+t,top:o._moveModalInfo.startModalY+n})},_dragEnd:function(a){var s=a.data.pu,e=a.data.index,d=s._modals[e];s._isDragging=!1,s._moveModalInfo=null,o(document).unbind("mouseup.acPU").unbind("mousemove.acPU"),d.modalIframe.css({display:"block"})},_disableSelection:function(a){a.attr("unselectable","on").css("MozUserSelect","none").bind("selectstart.acPU",function(){return!1})}},s=new l}a.acPU=s,o.fn.acPU=function(a){this.each(function(){var e=o(this);e.click(function(e){var d=o(this).attr("href");e.preventDefault(),s.open(d,a)})})}}(this,jQuery);